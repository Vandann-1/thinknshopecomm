{% for product in products %}
<div class="group relative bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col transition-all duration-300 hover:shadow-xl">
    
    <div class="absolute top-0 left-0 p-3 z-10 flex flex-col items-start gap-2">
        {% if product.is_new_arrival %}
        <span class="bg-blue-500 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">NEW</span>
        {% endif %}
        {% if product.get_discount_percent %}
        <span class="bg-primary-600 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">{{ product.get_discount_percent }}% OFF</span>
        {% endif %}
        {% if product.is_bestseller %}
        <span class="bg-yellow-400 text-gray-900 text-xs font-semibold px-2.5 py-0.5 rounded-full">BESTSELLER</span>
        {% endif %}
        {% if product.is_featured %}
        <span class="bg-gray-800 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">FEATURED</span>
        {% endif %}
    </div>

    <div class="absolute top-3 right-3 z-10 space-y-2 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-4 group-hover:translate-x-0">
        <button class="w-8 h-8 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-full shadow-md text-gray-800 hover:bg-white hover:text-primary-600 transition-colors" onclick="toggleWishlist({{ product.id }})" title="Add to Wishlist">
            ‚ô°
        </button>
        <button class="w-8 h-8 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-full shadow-md text-gray-800 hover:bg-white hover:text-primary-600 transition-colors" onclick="quickView({{ product.id }})" title="Quick View">
            üëÅ
        </button>
        <button class="w-8 h-8 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-full shadow-md text-gray-800 hover:bg-white hover:text-primary-600 transition-colors" onclick="addToCompare({{ product.id }})" title="Compare">
            ‚öñ
        </button>
    </div>

    <div class="relative w-full h-56">
        <a href="{% url 'products:product-detail' product.slug %}">
            {% if product.get_primary_image %}
            <img src="{{ product.get_primary_image }}" alt="{{ product.name }}" class="w-full h-full object-cover">
            {% else %}
            <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                <span class="text-gray-500 text-sm">No Image</span>
            </div>
            {% endif %}
        </a>
    </div>

    <div class="p-4 flex flex-col flex-1">
        <div class="text-xs text-gray-500 mb-1 truncate">{{ product.brand.name }} | {{ product.category.name }}</div>
        
        <h3 class="text-base font-semibold text-gray-900 mb-2 truncate">
            <a href="{% url 'products:product-detail' product.slug %}" class="hover:text-primary-600 transition-colors">
                {{ product.name }}
            </a>
        </h3>
        
        {% if product.avg_rating %}
        <div class="flex items-center gap-1 text-sm mb-2">
            <span class="text-yellow-400">
                {% for i in "12345" %}
                    {% if forloop.counter <= product.avg_rating|floatformat:0 %}‚òÖ{% else %}‚òÜ{% endif %}
                {% endfor %}
            </span>
            <span class="text-xs text-gray-500">({{ product.review_count }} reviews)</span>
        </div>
        {% endif %}

        <div class="flex items-baseline gap-2 flex-wrap my-2">
            {% if product.discounted_price %}
            <span class="text-xl font-bold text-primary-600">‚Çπ{{ product.discounted_price }}</span>
            <span class="text-sm text-gray-400 line-through">‚Çπ{{ product.base_price }}</span>
            <span class="text-xs font-semibold text-green-600 bg-green-50 px-2 py-0.5 rounded-md">{{ product.get_discount_percent }}% OFF</span>
            {% else %}
            <span class="text-xl font-bold text-gray-900">‚Çπ{{ product.base_price }}</span>
            {% endif %}
        </div>

        {% if product.get_available_colors %}
        <div class="flex items-center gap-1.5 my-3">
            {% for color in product.get_available_colors|slice:":5" %}
            <div class="w-5 h-5 rounded-full border border-gray-300" 
                 style="background: {{ color.hex_code }};" 
                 title="{{ color.name }}"></div>
            {% endfor %}
            {% if product.get_available_colors|length > 5 %}
            <span class="text-xs text-gray-500">+{{ product.get_available_colors|length|add:"-5" }}</span>
            {% endif %}
        </div>
        {% endif %}

        <div class="text-sm font-medium mb-3">
            {% if product.is_in_stock %}
            <span class="text-green-600">‚úì In Stock</span>
            {% else %}
            <span class="text-red-600">‚úó Out of Stock</span>
            {% endif %}
        </div>

        <div class="flex gap-2 mt-auto pt-4">
            <a href="{% url 'products:product-detail' product.slug %}" 
               class="flex-1 text-center py-2 px-4 bg-gray-900 text-white text-sm font-medium rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                View Details
            </a>
            
            {% if product.is_in_stock %}
            <button onclick="addToCart({{ product.id }})" 
                    class="py-2 px-3 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
                    title="Add to Cart">
                üõí
            </button>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}